/**
  ******************************************************************************
  * @file    bsp_bldcm_control.c
  * @author  fire
  * @version V1.0
  * @date    2019-xx-xx
  * @brief   无刷电机控制接口
  ******************************************************************************
  * @attention
  *
  * 实验平台:野火  STM32 F407 开发板 
  * 论坛    :http://www.firebbs.cn
  * 淘宝    :http://firestm32.taobao.com
  *
  ******************************************************************************
  */

#include "bsp_bldcm_control.h"

/* 私有变量 */
static bldcm_data_t bldcm_data;

/* 局部函数 */
static void sd_gpio_config(void);

/**
  * @brief  电机初始化
  * @param  无
  * @retval 无
  */
void bldcm_init(void) {
    MX_TIM8_Init();
    MX_TIM5_Init();
    sd_gpio_config();        // sd 引脚初始化
}

/**
  * @brief  电机 SD 控制引脚初始化
  * @param  无
  * @retval 无
  */
static void sd_gpio_config(void) {
    GPIO_InitTypeDef GPIO_InitStruct;

    /* 定时器通道功能引脚端口时钟使能 */
    SHUTDOWN_GPIO_CLK_ENABLE();

    /* 引脚IO初始化 */
    /*设置输出类型*/
    GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
    /*设置引脚速率 */
    GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_HIGH;
    /*选择要控制的GPIO引脚*/
    GPIO_InitStruct.Pin = SHUTDOWN_PIN;

    /*调用库函数，使用上面配置的GPIO_InitStructure初始化GPIO*/
    HAL_GPIO_Init(SHUTDOWN_GPIO_PORT, &GPIO_InitStruct);
}




/**
  * @brief  使能电机
  * @param  无
  * @retval 无
  */
void set_bldcm_enable(void) {
    BLDCM_ENABLE_SD();
    HAL_Delay(1);
    hall_enable();
}



/**
  * @brief  禁用电机
  * @param  无
  * @retval 无
  */
void set_bldcm_disable(void) {
    /* 禁用霍尔传感器接口 */
    hall_disable();

    /* 停止 PWM 输出 */
    stop_pwm_output();

    /* 关闭 MOS 管 */
    BLDCM_DISABLE_SD();
}

/*********************************************END OF FILE**********************/
